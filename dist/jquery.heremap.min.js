/**
* jQuery.heremap - jQuery plugin to facilitate the use of HereMap API
* @version v0.0.1
* @link https://github.com/romeroyonatan/jqueryheremap
* @author Yonatan Romero - https://github.com/romeroyonatan
* @license GPL-3.0
*/
(function(){var e,r,t,n,a,i,o,s,m,u=[].slice;e=window.jQuery||window.Zepto||window.$,e.heremap={},e.heremap.fn={},e.fn.heremap=function(){var r,t;return t=arguments[0],r=2<=arguments.length?u.call(arguments,1):[],null==t&&(t="init"),e.heremap.fn[t].apply(this,r)},m=null,s=null,o=function(){if("undefined"==typeof H||null===H)throw new Error("Don't forget include 'http://js.api.here.com/v3/3.0/mapsjs-core.js'");return m=new H.service.Platform({app_id:e.fn.heremap.options.app_id,app_code:e.fn.heremap.options.app_code}),s=m.createDefaultLayers()},n=function(r){var t,n;return n=e(r).data("center"),null!=n&&(t=/(-?\d+.?\d*),(-?\d+.?\d*)/.exec(n),null!=t)?{lat:parseFloat(t[1]),lng:parseFloat(t[2])}:e.fn.heremap.options.center},i=function(r){var t,n;return n=e(r).data("zoom"),null!=n&&(t=/(\d+)/.exec(n),null!=t)?parseInt(t[1]):e.fn.heremap.options.zoom},a=function(r){var t,n,a,i;return i=e(r).data("markers"),t=[],null!=i&&(a=/((-?\d+\.?\d*),(-?\d+\.?\d*))+/g,t=function(){var e;for(e=[];n=a.exec(i);)e.push({lat:parseFloat(n[2]),lng:parseFloat(n[3])});return e}()),t},e.heremap.fn.addMarker=function(r){return null!=r?this.each(function(t,n){var a,i;return a=e(n).data("heremap"),(null!=a?a:p)&&(e(n).data("heremap.markers")||e(n).data({"heremap.markers":[]}),i=new H.map.Marker(r),a.addObject(i),e(n).data("heremap.markers").push(i),0===a.getCenter().lat&&0===(null!=a?a.getCenter().lng:void 0))?a.setCenter(r):void 0}):void 0},e.heremap.fn.resize=function(){return this.each(function(r,t){var n;return n=e(t).data("heremap"),null!=n?n.getViewPort().resize():void 0})},e.heremap.fn.map=function(){return e(this).data("heremap")},e.heremap.fn.markers=function(){return e(this).data("heremap.markers")},t=function(t){var o,p,m,u,h,l,d,c,f,v;for(l=new H.Map(t,s.normal.map,{zoom:i(t),center:n(t)}),e(t).data({heremap:l}),f=a(t),u=0,h=f.length;h>u;u++)c=f[u],e(t).heremap("addMarker",c);return v=e(t).data("controls"),null!=v&&v&&H.ui.UI.createDefault(l,s,e.fn.heremap.options.lang),p=e(t).data("editable"),null!=p&&p&&(e.heremap.controller=new r(t)),m=e(t).data("interact"),!p&&null!=m&&m?(d=new H.mapevents.MapEvents(l),o=new H.mapevents.Behavior(d)):void 0},e.heremap.fn.init=function(r){return r=e.extend({},e.fn.heremap.options,r),this.length>0?(o(r),this.each(function(e,r){return t(r)})):void 0},e.fn.heremap.options={app_id:"",app_code:"",zoom:10,center:{lat:0,lng:0},lang:"en-US"},e(document).on("ready",function(){return e("[data-heremap]").heremap()}),r=function(){function r(r){this.elem=r,this.map=e(this.elem).heremap("map"),this.behavior=new H.mapevents.Behavior(new H.mapevents.MapEvents(this.map)),e(this.elem).heremap("markers")&&(this.marker=e(this.elem).heremap("markers")[0]),this.addDraggableMarker()}return r.prototype.addDraggableMarker=function(){return this.marker.draggable=!0,this.map.addEventListener("dragstart",function(e){return function(r){return r.target instanceof H.map.Marker?e.behavior.disable():void 0}}(this)),this.map.addEventListener("drag",function(e){return function(r){var t,n,a,i;return t=r.currentPointer,r.target instanceof H.map.Marker?(n=[t.viewportX,t.viewportY],a=n[0],i=n[1],r.target.setPosition(e.map.screenToGeo(a,i))):void 0}}(this)),this.map.addEventListener("dragend",function(r){return function(t){var n;return t.target instanceof H.map.Marker?(r.behavior.enable(),n=t.target.getPosition(),e(r.elem).trigger("heremap.marker.moved",n)):void 0}}(this)),this.map.addEventListener("contextmenu",function(r){return function(t){var n,a,i,o;return a=[t.viewportX,t.viewportY],i=a[0],o=a[1],n=r.map.screenToGeo(i,o),r.setMarkerPosition(n,!1),e(r.elem).trigger("heremap.marker.moved",n)}}(this))},r.prototype.setMarkerPosition=function(e,r){return null==r&&(r=!0),r&&this.map.setCenter(e),this.marker.setPosition(e)},r}()}).call(this);