/**
* jQuery.heremap - jQuery plugin to facilitate the use of HereMap API
* @version v0.0.1
* @link https://github.com/romeroyonatan/jqueryheremap
* @author Yonatan Romero - https://github.com/romeroyonatan
* @license GPL-3.0
*/
(function(){var e,r,t,n,a,i,o,s,u,h=[].slice;e=window.jQuery||window.Zepto||window.$,e.heremap={},e.heremap.fn={},e.fn.heremap=function(){var r,t;return t=arguments[0],r=2<=arguments.length?h.call(arguments,1):[],null==t&&(t="init"),e.heremap.fn[t].apply(this,r)},u=null,s=null,o=function(){if("undefined"==typeof H||null===H)throw new Error("Don't forget include 'http://js.api.here.com/v3/3.0/mapsjs-core.js'");return u=new H.service.Platform({app_id:e.fn.heremap.options.app_id,app_code:e.fn.heremap.options.app_code,useHTTPS:e.fn.heremap.options.https}),s=u.createDefaultLayers()},n=function(r){var t,n;return n=e(r).data("center"),null!=n&&(t=/(-?\d+.?\d*),(-?\d+.?\d*)/.exec(n),null!=t)?{lat:parseFloat(t[1]),lng:parseFloat(t[2])}:e.fn.heremap.options.center},i=function(r){var t,n;return n=e(r).data("zoom"),null!=n&&(t=/(\d+)/.exec(n),null!=t)?parseInt(t[1]):e.fn.heremap.options.zoom},a=function(r){var t,n,a,i;return i=e(r).data("markers"),t=[],null!=i&&(a=/((-?\d+\.?\d*),(-?\d+\.?\d*))+/g,t=function(){var e;for(e=[];n=a.exec(i);)e.push({lat:parseFloat(n[2]),lng:parseFloat(n[3])});return e}()),t},e.heremap.fn.addMarker=function(r){return null!=r?this.each(function(t,n){var a,i;return a=e(n).data("heremap"),(null!=a?a:p)&&(e(n).data("heremap.markers")||e(n).data({"heremap.markers":[]}),i=new H.map.Marker(r),a.addObject(i),e(n).data("heremap.markers").push(i),0===a.getCenter().lat&&0===(null!=a?a.getCenter().lng:void 0))?a.setCenter(r):void 0}):void 0},e.heremap.fn.setMarkerPosition=function(r,t){var n;return null==t&&(t=!0),n=e(this).data("heremap.editcontroller"),null!=n?n.setMarkerPosition(r,t):void 0},e.heremap.fn.resize=function(){return this.each(function(r,t){var n;return n=e(t).data("heremap"),null!=n?n.getViewPort().resize():void 0})},e.heremap.fn.map=function(){return e(this).data("heremap")},e.heremap.fn.markers=function(){return e(this).data("heremap.markers")},t=function(t){var o,p,u,h,m,l,d,c,f,v;if(e(t).data("heremap"))return!1;for(l=new H.Map(t,s.normal.map,{zoom:i(t),center:n(t)}),e(t).data({heremap:l}),f=a(t),h=0,m=f.length;m>h;h++)c=f[h],e(t).heremap("addMarker",c);return v=e(t).data("controls"),null!=v&&v&&H.ui.UI.createDefault(l,s,e.fn.heremap.options.lang),p=e(t).data("editable"),null!=p&&p&&e(t).data("heremap.editcontroller",new r(t)),u=e(t).data("interact"),!p&&null!=u&&u?(d=new H.mapevents.MapEvents(l),o=new H.mapevents.Behavior(d)):void 0},e.heremap.fn.init=function(r){return r=e.extend({},e.fn.heremap.options,r),this.length>0?(o(r),this.each(function(e,r){return t(r)})):void 0},e.fn.heremap.options={app_id:"",app_code:"",zoom:10,center:{lat:0,lng:0},lang:"en-US",https:!0},e(document).on("ready",function(){return e("[data-heremap]").heremap()}),r=function(){function r(r){this.elem=r,this.map=e(this.elem).heremap("map"),this.behavior=new H.mapevents.Behavior(new H.mapevents.MapEvents(this.map)),e(this.elem).heremap("markers")&&(this.marker=e(this.elem).heremap("markers")[0]),this.addDraggableMarker()}return r.prototype.addDraggableMarker=function(){return this.marker.draggable=!0,this.map.addEventListener("dragstart",function(e){return function(r){return r.target instanceof H.map.Marker?e.behavior.disable():void 0}}(this)),this.map.addEventListener("drag",function(e){return function(r){var t,n,a,i;return t=r.currentPointer,r.target instanceof H.map.Marker?(n=[t.viewportX,t.viewportY],a=n[0],i=n[1],r.target.setPosition(e.map.screenToGeo(a,i))):void 0}}(this)),this.map.addEventListener("dragend",function(e){return function(r){var t;return r.target instanceof H.map.Marker?(e.behavior.enable(),t=r.target.getPosition(),e.setMarkerPosition(t)):void 0}}(this)),this.map.addEventListener("contextmenu",function(e){return function(r){var t,n,a,i;return n=[r.viewportX,r.viewportY],a=n[0],i=n[1],t=e.map.screenToGeo(a,i),e.setMarkerPosition(t,!1)}}(this))},r.prototype.setMarkerPosition=function(r,t){return null==t&&(t=!0),t&&this.map.setCenter(r),this.marker.setPosition(r),e(this.elem).trigger("heremap.marker.moved",r)},r}()}).call(this);